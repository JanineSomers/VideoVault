<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload | Video Vault</title>
  <link rel="icon" href="logo.png" type="image/png" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#8e44ad" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <a href="index.html" class="home-btn">Home</a>
  <div class="container">
    <h1>Upload Video</h1>

    <form id="uploadForm">
      <input type="text" id="event" placeholder="Event" />
      <input type="date" id="date" required />
      <input type="text" id="venue" placeholder="Venue" required />
      <input type="text" id="performer" placeholder="Performer" />
      <input type="file" id="videoFile" accept="video/*" required />
      <button type="submit">Upload</button>
    </form>

    <div id="uploadStatus"></div>
  </div>

  <!-- âœ… Supabase v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://rzaakatvzghfgcdjllqf.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY-HERE"; // ðŸ”‘ keep yours here
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const uploadForm = document.getElementById("uploadForm");
    const uploadStatus = document.getElementById("uploadStatus");

    uploadForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const event = document.getElementById("event").value.trim();
      const date = document.getElementById("date").value;
      const venue = document.getElementById("venue").value.trim();
      const performer = document.getElementById("performer").value.trim();
      const file = document.getElementById("videoFile").files[0];

      if (!file) {
        uploadStatus.innerHTML = "<p>Please select a video file.</p>";
        return;
      }

      const fileName = `${Date.now()}-${file.name}`;
      const { data, error } = await supabase.storage.from("videos").upload(fileName, file);

      if (error) {
        uploadStatus.innerHTML = `<p>Error: ${error.message}</p>`;
        return;
      }

      const { data: publicUrl } = supabase.storage.from("videos").getPublicUrl(fileName);

      await supabase.from("videos").insert([{
        event_name: event,
        event_date: date,
        venue: venue,
        performed_by: performer,
        file_url: publicUrl.publicUrl
      }]);

      uploadStatus.innerHTML = "<p>âœ… Upload successful!</p>";
      uploadForm.reset();
    });
  </script>
</body>
</html>
